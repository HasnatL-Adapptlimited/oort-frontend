<div class="widget-container">
  <!-- CLASSIC VIEW -->
  <kendo-tilelayout-item-header *ngIf="header" class="widget-header">
    <span class="widget-title" [title]="settings.title">{{
      settings.title
    }}</span>
    <ng-container *ngIf="aggregations.length === 0">
      <ng-container *ngTemplateOutlet="layoutsTemplate"></ng-container>
      <ng-container *ngTemplateOutlet="floatingButtonsTemplate"></ng-container>
    </ng-container>
  </kendo-tilelayout-item-header>
  <!-- Core grid display -->
  <ng-container *ngIf="aggregations.length === 0">
    <!-- FULL WINDOW VIEW -->
    <ng-container *ngIf="!header">
      <ng-container *ngTemplateOutlet="floatingButtonsTemplate"></ng-container>
    </ng-container>
    <!-- GRID CONTENT -->
    <ng-container *ngTemplateOutlet="coreGridTemplate"></ng-container>
  </ng-container>

  <!-- Aggregation grid display -->
  <ng-container *ngIf="aggregations.length > 0">
    <!-- GRID CONTENT -->
    <ng-container *ngTemplateOutlet="aggregationGridTemplate"></ng-container>
  </ng-container> 
</div>

<!-- Core Grid ( data query / layout )-->
<ng-template #coreGridTemplate>
  <safe-core-grid
    [defaultLayout]="layout?.display || {}"
    [settings]="gridSettings"
    [admin]="isAdmin"
    (defaultLayoutReset)="onResetLayout()"
    (edit)="edit.emit($event)"
    [widget]="widget"
    [canUpdate]="canUpdate"
  ></safe-core-grid>
</ng-template>

<!-- Aggregation Grid -->
<ng-template #aggregationGridTemplate>
  <div>Aggregation test</div>
</ng-template>

<!-- Quick action buttons -->
<ng-template #floatingButtonsTemplate>
  <div>
    <ng-container *ngFor="let floatingButton of settings.floatingButtons">
      <button
        mat-button
        color="primary"
        (click)="onQuickAction(floatingButton)"
        *ngIf="floatingButton.show"
      >
        {{ floatingButton.name }}
      </button>
    </ng-container>
  </div>
</ng-template>

<!-- Selection of layouts -->
<ng-template #layoutsTemplate>
  <ng-container *ngIf="layouts.length > 1">
    <kendo-dropdownlist
      class="grid-layout-dropdown"
      [data]="layouts"
      textField="name"
      valueField="id"
      [value]="layout"
      (selectionChange)="onLayoutChange($event)"
    >
    </kendo-dropdownlist>
  </ng-container>
</ng-template>

<!-- Selection of aggregations -->
<ng-template #aggregationsTemplate></ng-template>
